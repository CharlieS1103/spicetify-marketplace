var marketplace=(()=>{var e,M=Object.create,n=Object.defineProperty,F=Object.defineProperties,q=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,G=Object.getPrototypeOf,i=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,r=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,p=(e,t)=>{for(var a in t=t||{})i.call(t,a)&&r(e,a,t[a]);if(s)for(var a of s(t))U.call(t,a)&&r(e,a,t[a]);return e},d=(e,t)=>F(e,$(t)),a=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)(function(e){if("react"===e)return Spicetify.React;if("react-dom"===e)return Spicetify.ReactDOM;if("undefined"!=typeof require)return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),t=(e,t)=>function(){return t||(0,e[l(e)[0]])((t={exports:{}}).exports,t),t.exports},o=(t,a,s,r)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let e of l(a))i.call(t,e)||e===s||n(t,e,{get:()=>a[e],enumerable:!(r=q(a,e))||r.enumerable});return t},c=(e,t,a)=>(a=null!=e?M(G(e)):{},o(!t&&e&&e.__esModule?a:n(a,"default",{value:e,enumerable:!0}),e)),K=t({"node_modules/classnames/index.js"(e,t){!function(){"use strict";var l={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var a=arguments[t];if(a){var s,r=typeof a;if("string"==r||"number"==r)e.push(a);else if(Array.isArray(a))!a.length||(s=i.apply(null,a))&&e.push(s);else if("object"==r)if(a.toString===Object.prototype.toString)for(var n in a)l.call(a,n)&&a[n]&&e.push(n);else e.push(a.toString())}}return e.join(" ")}void 0!==t&&t.exports?t.exports=i.default=i:"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],function(){return i}):window.classNames=i}()}}),t=t({"node_modules/react-dropdown/dist/index.js"(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var m=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var t=l();if(t&&t.has(e))return t.get(e);var a,s={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(a in e){var n;Object.prototype.hasOwnProperty.call(e,a)&&((n=r?Object.getOwnPropertyDescriptor(e,a):null)&&(n.get||n.set)?Object.defineProperty(s,a,n):s[a]=e[a])}s.default=e,t&&t.set(e,s);return s}(a("react")),p=(t=K())&&t.__esModule?t:{default:t};function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,s=arguments[t];for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function c(t,e){var a,s=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)),s}function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f="Select...",t=function(e){var t,a=s;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function s(e){var t,a;if(this instanceof s)return t=this,(t=!(a=n(s).call(this,e))||"object"!==i(a)&&"function"!=typeof a?u(t):a).state={selected:t.parseValue(e.value,e.options)||{label:void 0===e.placeholder?f:e.placeholder,value:""},isOpen:!1},t.dropdownRef=(0,m.createRef)(),t.mounted=!0,t.handleDocumentClick=t.handleDocumentClick.bind(u(t)),t.fireChangeEvent=t.fireChangeEvent.bind(u(t)),t;throw new TypeError("Cannot call a class as a function")}return a.prototype=Object.create(e&&e.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),e&&h(a,e),a=s,(e=[{key:"componentDidUpdate",value:function(e){this.props.value!==e.value&&(this.props.value?(e=this.parseValue(this.props.value,this.props.options))!==this.state.selected&&this.setState({selected:e}):this.setState({selected:{label:void 0===this.props.placeholder?f:this.props.placeholder,value:""}}))}},{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleDocumentClick,!1),document.addEventListener("touchend",this.handleDocumentClick,!1)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,document.removeEventListener("click",this.handleDocumentClick,!1),document.removeEventListener("touchend",this.handleDocumentClick,!1)}},{key:"handleMouseDown",value:function(e){this.props.onFocus&&"function"==typeof this.props.onFocus&&this.props.onFocus(this.state.isOpen),"mousedown"===e.type&&0!==e.button||(e.stopPropagation(),e.preventDefault(),this.props.disabled||this.setState({isOpen:!this.state.isOpen}))}},{key:"parseValue",value:function(t,e){var a;if("string"==typeof t)for(var s,r=0,n=e.length;r<n;r++)"group"===e[r].type?(s=e[r].items.filter(function(e){return e.value===t})).length&&(a=s[0]):void 0!==e[r].value&&e[r].value===t&&(a=e[r]);return a||t}},{key:"setValue",value:function(e,t){e={selected:{value:e,label:t},isOpen:!1};this.fireChangeEvent(e),this.setState(e)}},{key:"fireChangeEvent",value:function(e){e.selected!==this.state.selected&&this.props.onChange&&this.props.onChange(e.selected)}},{key:"renderOption",value:function(a){var e=a.value,t=(void 0===e&&(e=a.label||a),a.label||a.value||a),s=e===this.state.selected.value||e===this.state.selected;d(r={},"".concat(this.props.baseClassName,"-option"),!0),d(r,a.className,!!a.className),d(r,"is-selected",s);var r=(0,p.default)(r),n=Object.keys(a.data||{}).reduce(function(e,t){return function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?c(a,!0).forEach(function(e){d(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):c(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}({},e,d({},"data-".concat(t),a.data[t]))},{});return m.default.createElement("div",o({key:e,className:r,onMouseDown:this.setValue.bind(this,e,t),onClick:this.setValue.bind(this,e,t),role:"option","aria-selected":s?"true":"false"},n),t)}},{key:"buildMenu",value:function(){var s=this,e=this.props,t=e.options,r=e.baseClassName,e=t.map(function(e){var t,a;return"group"===e.type?(t=m.default.createElement("div",{className:"".concat(r,"-title")},e.name),a=e.items.map(function(e){return s.renderOption(e)}),m.default.createElement("div",{className:"".concat(r,"-group"),key:e.name,role:"listbox",tabIndex:"-1"},t,a)):s.renderOption(e)});return e.length?e:m.default.createElement("div",{className:"".concat(r,"-noresults")},"No options found")}},{key:"handleDocumentClick",value:function(e){!this.mounted||this.dropdownRef.current.contains(e.target)||this.state.isOpen&&this.setState({isOpen:!1})}},{key:"isValueSelected",value:function(){return"string"==typeof this.state.selected||""!==this.state.selected.value}},{key:"render",value:function(){var e=this.props,t=e.baseClassName,a=e.controlClassName,s=e.placeholderClassName,r=e.menuClassName,n=e.arrowClassName,l=e.arrowClosed,i=e.arrowOpen,e=e.className,o=this.props.disabled?"Dropdown-disabled":"",c="string"==typeof this.state.selected?this.state.selected:this.state.selected.label,e=(0,p.default)((d(u={},"".concat(t,"-root"),!0),d(u,e,!!e),d(u,"is-open",this.state.isOpen),u)),a=(0,p.default)((d(u={},"".concat(t,"-control"),!0),d(u,a,!!a),d(u,o,!!o),u)),u=(0,p.default)((d(o={},"".concat(t,"-placeholder"),!0),d(o,s,!!s),d(o,"is-selected",this.isValueSelected()),o)),o=(0,p.default)((d(s={},"".concat(t,"-menu"),!0),d(s,r,!!r),s)),s=(0,p.default)((d(r={},"".concat(t,"-arrow"),!0),d(r,n,!!n),r)),n=m.default.createElement("div",{className:u},c),r=this.state.isOpen?m.default.createElement("div",{className:o,"aria-expanded":"true"},this.buildMenu()):null;return m.default.createElement("div",{ref:this.dropdownRef,className:e},m.default.createElement("div",{className:a,onMouseDown:this.handleMouseDown.bind(this),onTouchEnd:this.handleMouseDown.bind(this),"aria-haspopup":"listbox"},n,m.default.createElement("div",{className:"".concat(t,"-arrow-wrapper")},i&&l?this.state.isOpen?i:l:m.default.createElement("span",{className:s}))),r)}}])&&r(a.prototype,e),t&&r(a,t),s}(m.Component);t.defaultProps={baseClassName:"Dropdown"},e.default=t}}),D={},B=D,J={default:()=>function(){return Ie.default.createElement(Oe,null)}};for(e in J)n(B,e,{get:J[e],enumerable:!0});var u=c(a("react")),m=c(a("react")),h=(t,e)=>{t=localStorage.getItem(t);if(!t)return e;try{return JSON.parse(t)}catch(e){return t}},f=e=>{const t=document.querySelector("style.marketplaceSnippets"),a=(t&&t.remove(),document.createElement("style"));e=e.reduce((e,t)=>e=(e+=`/* ${t.title} - ${t.description} */
`)+t.code+`
`,"");a.innerHTML=e,a.classList.add("marketplaceSnippets"),document.head.appendChild(a)},W=(e,t)=>{let a=[];return e&&0<e.length?a=e:a.push({name:t,url:"https://github.com/"+t}),a},H=()=>{console.log("Resetting Marketplace"),Object.keys(localStorage).forEach(e=>{e.startsWith("marketplace:")&&(localStorage.removeItem(e),console.log("Removed "+e))}),console.log("Marketplace has been reset"),location.reload()},V=a=>{const e=document.querySelector("link[href='colors.css']"),t=(e&&e.remove(),document.querySelector("style.marketplaceCSS.marketplaceScheme"));if(t&&t.remove(),a){const s=document.createElement("style");s.classList.add("marketplaceCSS"),s.classList.add("marketplaceScheme");let t=":root {";const r=Object.keys(a);r.forEach(e=>{t=(t+=`--spice-${e}: #${a[e]};`)+`--spice-rgb-${e}: ${(e=>{if(3===e.length)e=e.split("").map(e=>e+e).join("");else{if(6!=e.length)throw"Only 3- or 6-digit hex colours are allowed.";if(e.match(/[^0-9a-f]/i))throw"Only hex colours are allowed."}e=e.match(/.{1,2}/g);if(e&&3===e.length)return[parseInt(e[0],16),parseInt(e[1],16),parseInt(e[2],16)];throw"Could not parse hex colour."})(a[e])};`}),t+="}",s.innerHTML=t,document.head.appendChild(s)}else{const n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href","colors.css"),n.classList.add("userCSS"),document.head.appendChild(n)}};var g="marketplace:installed-extensions",y="marketplace:installed-snippets",v="marketplace:installed-themes",z="marketplace:active-tab",b="marketplace:tabs",Q="marketplace:sort-by",S="marketplace:theme-installed",Y=[{name:"Extensions",enabled:!0},{name:"Themes",enabled:!0},{name:"Snippets",enabled:!0},{name:"Installed",enabled:!0}],E=100,X="/marketplace",k=c(a("react")),C=c(a("react")),Z=()=>{return C.default.createElement("div",{id:"marketplace-add-snippet-container"},C.default.createElement("div",{className:"marketplace-customCSS-input-container"},C.default.createElement("label",{htmlFor:"marketplace-custom-css"},"Custom CSS"),C.default.createElement("textarea",{id:"marketplace-custom-css",name:"marketplace-custom-css",rows:4,cols:50,placeholder:"Input your own custom CSS here! You can find them in the installed tab for management."})),C.default.createElement("div",{className:"marketplace-customCSS-input-container"},C.default.createElement("label",{htmlFor:"marketplace-customCSS-name-submit"},"Snippet Name"),C.default.createElement("input",{id:"marketplace-customCSS-name-submit",name:"marketplace-customCSS-name-submit",placeholder:"Enter a name for your custom snippet."})),C.default.createElement("div",{className:"marketplace-customCSS-input-container"},C.default.createElement("label",{htmlFor:"marketplace-customCSS-description-submit"},"Snippet Description"),C.default.createElement("input",{id:"marketplace-customCSS-description-submit",name:"marketplace-customCSS-description-submit",placeholder:"Enter a description for your custom snippet."})),C.default.createElement("button",{className:"main-buttons-button main-button-secondary",id:"marketplace-customCSS-submit",onClick:function(){const e=document.querySelector("#marketplace-custom-css"),t=document.querySelector("#marketplace-customCSS-name-submit"),a=document.querySelector("#marketplace-customCSS-description-submit");var s=e.value.replace(/\n/g,""),r=t.value.replace(/\n/g,""),n=a.value.trim(),l="marketplace:installed:snippet:"+r;if(h(l))alert("That name is already taken!");else{console.log("Installing snippet: "+r),localStorage.setItem(l,JSON.stringify({code:s,description:n,title:r}));const i=h(y,[]);-1===i.indexOf(l)&&(i.push(l),localStorage.setItem(y,JSON.stringify(i)));s=i.map(e=>h(e));f(s),Spicetify.PopupModal.hide()}}},"Save CSS"))},w=c(a("react")),ee=()=>w.default.createElement("div",{id:"marketplace-reload-container"},w.default.createElement("p",null,"A page reload is required to complete this operation."),w.default.createElement("div",{className:"marketplace-reload-modal__button-container"},w.default.createElement("button",{id:"marketplace-reload-okay",className:"main-buttons-button main-button-secondary main-playlistEditDetailsModal-save",onClick:()=>{Spicetify.PopupModal.hide(),location.reload()}},"Reload now"),w.default.createElement("button",{id:"marketplace-reload-cancel",className:"main-buttons-button main-button-secondary main-playlistEditDetailsModal-save",onClick:()=>{Spicetify.PopupModal.hide()}},"Reload later"))),N=c(a("react")),O=c(a("react")),I=t=>{var e=!!t.CONFIG.visual[t.storageKey];console.log(`toggling ${t.storageKey} to `+e);return O.default.createElement("div",{className:"setting-row"},O.default.createElement("label",{className:"col description"},t.name),O.default.createElement("div",{className:"col action"},O.default.createElement("label",{className:"x-toggle-wrapper "+(t.classes?t.classes.join(" "):"")},O.default.createElement("input",{title:"Toggle for "+t.storageKey,className:"x-toggle-input",type:"checkbox",checked:e,onChange:e=>{e=e.target.checked;t.CONFIG.visual[t.storageKey]=e,localStorage.setItem("marketplace:"+t.storageKey,String(e)),t.triggerRefresh(t.CONFIG)}}),O.default.createElement("span",{className:"x-toggle-indicatorWrapper"},O.default.createElement("span",{className:"x-toggle-indicator"})))))},te=({CONFIG:r,triggerRefresh:n})=>{function a(e,t){console.log({currPos:e,dir:t});var t=e+t,a=r.tabs[t];r.tabs[t]=r.tabs[e],r.tabs[e]=a,localStorage.setItem(b,JSON.stringify(r.tabs)),n(r)}function s(e,t){return N.default.createElement("div",{className:"setting-row",key:e},N.default.createElement("h3",{className:"col description"},e),N.default.createElement("div",{className:"col action"},N.default.createElement("button",{title:"Move up",className:"arrow-btn",onClick:()=>a(t,-1)},N.default.createElement("svg",{height:"16",width:"16",viewBox:"0 0 16 16",fill:"currentColor"},"$",Spicetify.SVGIcons["chart-up"])),N.default.createElement("button",{title:"Move down",className:"arrow-btn",onClick:()=>a(t,1)},N.default.createElement("svg",{height:"16",width:"16",viewBox:"0 0 16 16",fill:"currentColor"},"$",Spicetify.SVGIcons["chart-down"])),function(s,e){const t=r.tabs.reduce((e,t,a)=>t.name===s?a:e,-1);var a=r.tabs[t]["enabled"];return N.default.createElement("label",{className:"x-toggle-wrapper "+(e?e.join(" "):"")},N.default.createElement("input",{type:"checkbox",className:"x-toggle-input",title:"Toggle for "+s,checked:a,disabled:"Extensions"===s,onChange:e=>{console.log({e:e}),r.tabs[t].enabled=e.target.checked,localStorage.setItem(b,JSON.stringify(r.tabs)),n(r)}}),N.default.createElement("span",{className:"x-toggle-indicatorWrapper"},N.default.createElement("span",{className:"x-toggle-indicator"})))}(e,"Extensions"===e?["disabled"]:[])))}return console.log(r),N.default.createElement("div",{id:"marketplace-config-container"},N.default.createElement("h2",null,"Options"),N.default.createElement(I,{name:"Stars count",storageKey:"stars",CONFIG:r,triggerRefresh:n}),N.default.createElement(I,{name:"Tags",storageKey:"tags",CONFIG:r,triggerRefresh:n}),N.default.createElement(I,{name:"Hide installed in Marketplace",storageKey:"hideInstalled",CONFIG:r,triggerRefresh:n}),N.default.createElement(I,{name:"Shift Colors Every Minute",storageKey:"colorShift",CONFIG:r,triggerRefresh:n}),N.default.createElement("h2",null,"Tabs"),N.default.createElement("div",{className:"tabs-container"},r.tabs.map(({name:e},t)=>s(e,t))),N.default.createElement("h2",null,"Reset"),N.default.createElement("div",{className:"setting-row"},N.default.createElement("label",{className:"col description"},"Uninstall all extensions and themes, and reset preferences"),N.default.createElement("div",{className:"col action"},N.default.createElement("button",{className:"main-buttons-button main-button-secondary",onClick:H},"Reset"))))},x=(e,t,a)=>{e=((e,t,a)=>{switch(e){case"ADD_SNIPPET":return{title:"Add Snippet",content:k.default.createElement(Z,null),isLarge:!1};case"RELOAD":return{title:"Reload",content:k.default.createElement(ee,null),isLarge:!1};case"SETTINGS":return{title:"Settings",content:k.default.createElement(te,{CONFIG:t,triggerRefresh:a}),isLarge:!0};default:return{title:"",content:null,isLarge:!1}}})(e,t,a),Spicetify.PopupModal.display(e)};async function ae(e,t,a){var s=window.sessionStorage.getItem(e+"-"+t);const r=window.sessionStorage.getItem("noManifests");if(s)return JSON.parse(s);const n=`https://raw.githubusercontent.com/${e}/${t}/${a}/manifest.json`;if(null!=r&&r.includes(n))return null;s=await fetch(n).then(e=>e.json()).catch(()=>{var s=[n],r="noManifests";s&&null!=s&&s.forEach(e=>{r=r||s.user+"-"+s.repo;var t=window.sessionStorage.getItem(r);const a=t?JSON.parse(t):[];a.push(e),window.sessionStorage.setItem(r,JSON.stringify(a))})});return s&&window.sessionStorage.setItem(e+"-"+t,JSON.stringify(s)),s}var L=c(a("react")),se=class extends L.default.Component{render(){return L.default.createElement("div",{onClick:this.props.onClick},L.default.createElement("p",{style:{fontSize:100,lineHeight:"65px"}},"»"),L.default.createElement("span",{style:{fontSize:20}},"Load more"))}},R=c(a("react")),re=()=>R.default.createElement("svg",{width:"100px",height:"100px",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},R.default.createElement("circle",{cx:"50",cy:"50",r:"0",fill:"none",stroke:"currentColor",strokeWidth:"2"},R.default.createElement("animate",{attributeName:"r",repeatCount:"indefinite",dur:"1s",values:"0;40",keyTimes:"0;1",keySplines:"0 0.2 0.8 1",calcMode:"spline",begin:"0s"}),R.default.createElement("animate",{attributeName:"opacity",repeatCount:"indefinite",dur:"1s",values:"1;0",keyTimes:"0;1",keySplines:"0.2 0 0.8 1",calcMode:"spline",begin:"0s"})),R.default.createElement("circle",{cx:"50",cy:"50",r:"0",fill:"none",stroke:"currentColor",strokeWidth:"2"},R.default.createElement("animate",{attributeName:"r",repeatCount:"indefinite",dur:"1s",values:"0;40",keyTimes:"0;1",keySplines:"0 0.2 0.8 1",calcMode:"spline",begin:"-0.5s"}),R.default.createElement("animate",{attributeName:"opacity",repeatCount:"indefinite",dur:"1s",values:"1;0",keyTimes:"0;1",keySplines:"0.2 0 0.8 1",calcMode:"spline",begin:"-0.5s"}))),ne=c(a("react")),le=()=>ne.default.createElement("svg",{role:"img",width:"16",height:"16",viewBox:"0 0 24 24","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg"},ne.default.createElement("path",{d:"M24 13.616v-3.232c-1.651-.587-2.694-.752-3.219-2.019v-.001c-.527-1.271.1-2.134.847-3.707l-2.285-2.285c-1.561.742-2.433 1.375-3.707.847h-.001c-1.269-.526-1.435-1.576-2.019-3.219h-3.232c-.582 1.635-.749 2.692-2.019 3.219h-.001c-1.271.528-2.132-.098-3.707-.847l-2.285 2.285c.745 1.568 1.375 2.434.847 3.707-.527 1.271-1.584 1.438-3.219 2.02v3.232c1.632.58 2.692.749 3.219 2.019.53 1.282-.114 2.166-.847 3.707l2.285 2.286c1.562-.743 2.434-1.375 3.707-.847h.001c1.27.526 1.436 1.579 2.019 3.219h3.232c.582-1.636.75-2.69 2.027-3.222h.001c1.262-.524 2.12.101 3.698.851l2.285-2.286c-.744-1.563-1.375-2.433-.848-3.706.527-1.271 1.588-1.44 3.221-2.021zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z",fill:"currentColor"})),T=c(a("react")),ie=c(t()),oe=t=>{var e=t.sortBoxOptions.map(e=>({value:e.key,label:e.value})),a=t.sortBoxOptions.find(t.sortBySelectedFn);return T.default.createElement("div",{className:"marketplace-sortBox"},T.default.createElement("div",{className:"marketplace-sortBox-header"},T.default.createElement("div",{className:"marketplace-sortBox-header-title"}),T.default.createElement(ie.default,{className:"marketplace-sortBox-header-selector-select",options:e,value:null==a?void 0:a.key,placeholder:"Select an option",onChange:e=>{t.onChange(e.value)}})))},P=c(a("react")),ce=c(a("react-dom")),ue=c(t()),me=class extends P.default.Component{constructor(e){super(e)}render(){return this.props.item.enabled?P.default.createElement("li",{className:"marketplace-tabBar-headerItem","data-tab":this.props.item.value,onClick:e=>{e.preventDefault(),this.props.switchTo(this.props.item.key)}},P.default.createElement("a",{"aria-current":"page",className:"marketplace-tabBar-headerItemLink "+(this.props.item.active?"marketplace-tabBar-active":""),draggable:"false",href:""},P.default.createElement("span",{className:"main-type-mestoBold"},this.props.item.value))):null}},pe=P.default.memo(function({items:e,switchTo:t}){e=e.map(e=>({value:e.key,label:e.value}));return P.default.createElement("li",{className:"marketplace-tabBar-headerItem"},P.default.createElement(ue.default,{className:"marketplace-sortBox-header-selector-select",options:e,value:"More",placeholder:"More",onChange:e=>{t(e.value)}}))}),de=({children:e})=>ce.default.createPortal(P.default.createElement("div",{className:"main-topBar-topbarContent"},e),document.querySelector(".main-topBar-topbarContentWrapper")),he=e=>{const t=document.querySelector(".Root__main-view .os-resize-observer-host");if(!t)return null;const[a,s]=(0,P.useState)(t.clientWidth),r=()=>s(t.clientWidth);return(0,P.useEffect)(()=>{const e=new ResizeObserver(r);return e.observe(t),()=>{e.disconnect()}},[r]),P.default.createElement(de,null,P.default.createElement(fe,{windowSize:a,links:e.links,activeLink:e.activeLink,switchCallback:e.switchCallback}))},fe=P.default.memo(function({links:e,activeLink:a,switchCallback:t,windowSize:s=1/0}){const r=P.default.useRef(null),[n,l]=(0,P.useState)([]),[i,o]=(0,P.useState)(0),[c,u]=(0,P.useState)([]),m=e.map(({name:e,enabled:t})=>{return{key:e,value:e,active:e===a,enabled:t}});return(0,P.useEffect)(()=>{r.current&&o(r.current.clientWidth)},[s]),(0,P.useEffect)(()=>{if(r.current){const t=Array.from(r.current.children);var e=t.map(e=>e.clientWidth);l(e)}},[e]),(0,P.useEffect)(()=>{if(r.current)if(n.reduce((e,t)=>e+t,0)<=i)u([]);else{var e=Math.max(...n);const s=[];let a=e;n.forEach((e,t)=>{i>=a+e?a+=e:s.push(t)}),u(s)}},[i,n]),P.default.createElement("nav",{className:"marketplace-tabBar marketplace-tabBar-nav"},P.default.createElement("ul",{className:"marketplace-tabBar-header",ref:r},m.filter((e,t)=>!c.includes(t)).map(e=>P.default.createElement(me,{key:e.key,item:e,switchTo:t})),c.length||0===n.length?P.default.createElement(pe,{items:c.map(e=>m[e]).filter(e=>e),switchTo:t}):null))}),A=c(a("react")),ge=c(a("react")),ye=()=>ge.default.createElement("svg",{role:"img",width:"16",height:"16",viewBox:"0 0 448 512","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg"},ge.default.createElement("path",{d:"M53.21 467c1.562 24.84 23.02 45 47.9 45h245.8c24.88 0 46.33-20.16 47.9-45L416 128H32L53.21 467zM432 32H320l-11.58-23.16c-2.709-5.42-8.25-8.844-14.31-8.844H153.9c-6.061 0-11.6 3.424-14.31 8.844L128 32H16c-8.836 0-16 7.162-16 16V80c0 8.836 7.164 16 16 16h416c8.838 0 16-7.164 16-16V48C448 39.16 440.8 32 432 32z",fill:"currentColor"})),ve=c(a("react")),be=()=>ve.default.createElement("svg",{role:"img",width:"16",height:"16",viewBox:"0 0 512 512","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg"},ve.default.createElement("path",{d:"M480 352h-133.5l-45.25 45.25C289.2 409.3 273.1 416 256 416s-33.16-6.656-45.25-18.75L165.5 352H32c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h448c17.67 0 32-14.33 32-32v-96C512 366.3 497.7 352 480 352zM432 456c-13.2 0-24-10.8-24-24c0-13.2 10.8-24 24-24s24 10.8 24 24C456 445.2 445.2 456 432 456zM233.4 374.6C239.6 380.9 247.8 384 256 384s16.38-3.125 22.62-9.375l128-128c12.49-12.5 12.49-32.75 0-45.25c-12.5-12.5-32.76-12.5-45.25 0L288 274.8V32c0-17.67-14.33-32-32-32C238.3 0 224 14.33 224 32v242.8L150.6 201.4c-12.49-12.5-32.75-12.5-45.25 0c-12.49 12.5-12.49 32.75 0 45.25L233.4 374.6z",fill:"currentColor"})),Se=c(a("react")),Ee=e=>{return Se.default.createElement("div",{className:"marketplace-card__authors"},e.authors.map((e,t)=>Se.default.createElement("a",{title:e.name,className:"marketplace-card__author",href:e.url,draggable:"false",dir:"auto",target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),key:t},e.name)))},j=c(a("react")),ke=a=>{const[e,t]=j.default.useState(!1);var s=e=>e.reduce((e,t)=>(!a.showTags&&"external JS"!==t||e.push(j.default.createElement("li",{className:"marketplace-card__tag",draggable:!1,"data-tag":t},t)),e),[]),r=a.tags.slice(0,4),n=a.tags.slice(4);return j.default.createElement("div",{className:"marketplace-card__tags-container"},j.default.createElement("ul",{className:"marketplace-card__tags"},s(r),n.length&&e?s(n):null),n.length&&!e?j.default.createElement("button",{className:"marketplace-card__tags-more-btn",onClick:e=>{e.stopPropagation(),t(!0)}},"..."):null)},Ce=class extends A.default.Component{constructor(e){super(e),this.menuType=Spicetify.ReactComponent.Menu;var t,a="snippet"===e.type?"snippet:":`${e.item.user}/${e.item.repo}/`;let s="";"snippet"===e.type?s=e.item.title.replaceAll(" ","-"):"theme"===e.type?s=(null==(t=e.item.manifest)?void 0:t.usercss)||"":"extension"===e.type&&(s=(null==(t=e.item.manifest)?void 0:t.main)||""),this.localStorageKey="marketplace:installed:"+a+s,Object.assign(this,e),this.tags=e.item.tags||[],e.item.include&&this.tags.push("external JS"),this.state={installed:null!==localStorage.getItem(this.localStorageKey),stars:this.props.item.stars||0,tagsExpanded:!1}}isInstalled(){return null!==localStorage.getItem(this.localStorageKey)}async componentDidMount(){var e;"Installed"===this.props.CONFIG.activeTab&&this.props.CONFIG.visual.stars&&"snippet"!==this.props.type&&(e=`https://api.github.com/repos/${this.props.item.user}/`+this.props.item.repo,e=await fetch(e).then(e=>e.json()),this.state.stars!==e.stargazers_count&&this.setState({stars:e.stargazers_count},()=>{console.log(`Stars updated to: ${this.state.stars}; updating localstorage.`),this.installExtension()}))}buttonClicked(){var e,t;"extension"===this.props.type?(this.isInstalled()?(console.log("Extension already installed, removing"),this.removeExtension()):this.installExtension(),x("RELOAD")):"theme"===this.props.type?(t=(e=localStorage.getItem("marketplace:theme-installed"))?h(e,{}):{},console.log(t),console.log(e),this.isInstalled()?(console.log("Theme already installed, removing"),this.removeTheme(this.localStorageKey)):(this.removeTheme(),this.installTheme()),(null!=(e=this.props.item.manifest)&&e.include||t.include)&&x("RELOAD")):"snippet"===this.props.type?this.isInstalled()?(console.log("Snippet already installed, removing"),this.removeSnippet()):this.installSnippet():console.error("Unknown card type")}installExtension(){var e;console.log("Installing extension "+this.localStorageKey),localStorage.setItem(this.localStorageKey,JSON.stringify({manifest:null==(e=this.props.item)?void 0:e.manifest,type:this.props.type,title:this.props.item.title,subtitle:this.props.item.subtitle,authors:this.props.item.authors,user:this.props.item.user,repo:this.props.item.repo,branch:this.props.item.branch,imageURL:this.props.item.imageURL,extensionURL:this.props.item.extensionURL,readmeURL:this.props.item.readmeURL,stars:this.state.stars}));const t=h(g,[]);-1===t.indexOf(this.localStorageKey)&&(t.push(this.localStorageKey),localStorage.setItem(g,JSON.stringify(t))),console.log("Installed"),this.setState({installed:!0})}removeExtension(){if(localStorage.getItem(this.localStorageKey)){console.log("Removing extension "+this.localStorageKey),localStorage.removeItem(this.localStorageKey);const t=h(g,[]);var e=t.filter(e=>e!==this.localStorageKey);localStorage.setItem(g,JSON.stringify(e)),console.log("Removed"),this.setState({installed:!1})}}async installTheme(){var e;console.log("Installing theme "+this.localStorageKey);let t=null;if(this.props.item.schemesURL){const r=await fetch(this.props.item.schemesURL);var a=await r.text();t=(e=>{const a={section:/^\s*\[\s*([^\]]*)\s*\]\s*$/,param:/^\s*([^=]+?)\s*=\s*(.*?)\s*$/,comment:/^\s*;.*$/},s={},t=e.split(/[\r\n]+/);let r=null;return t.forEach(function(e){var t;a.comment.test(e)||(a.param.test(e)?(t=e.match(a.param),r?s[r][t[1]]=t[2]:s[t[1]]=t[2]):a.section.test(e)?(t=e.match(a.section),s[t[1]]={},r=t[1]):0==e.length&&r&&(r=null))}),s})(a)}console.log(t),console.log(Object.keys(t)[0]);a=t?Object.keys(t)[0]:null;localStorage.setItem(this.localStorageKey,JSON.stringify({manifest:null==(e=this.props.item)?void 0:e.manifest,type:this.props.type,title:this.props.item.title,subtitle:this.props.item.subtitle,authors:this.props.item.authors,user:this.props.item.user,repo:this.props.item.repo,branch:this.props.item.branch,imageURL:this.props.item.imageURL,extensionURL:this.props.item.extensionURL,readmeURL:this.props.item.readmeURL,stars:this.state.stars,tags:this.tags,cssURL:this.props.item.cssURL,schemesURL:this.props.item.schemesURL,include:this.props.item.include,schemes:t,activeScheme:a}));const s=h(v,[]);-1===s.indexOf(this.localStorageKey)&&(s.push(this.localStorageKey),localStorage.setItem(v,JSON.stringify(s)),localStorage.setItem(S,this.localStorageKey)),console.log("Installed"),this.props.item.include||(this.fetchAndInjectUserCSS(this.localStorageKey),this.props.updateActiveTheme(this.localStorageKey),this.props.updateColourSchemes(t,a)),this.setState({installed:!0})}removeTheme(t=null){if((t=t||localStorage.getItem(S))&&localStorage.getItem(t)){console.log("Removing theme "+t),localStorage.removeItem(t),localStorage.removeItem(S);const a=h(v,[]);var e=a.filter(e=>e!==t);localStorage.setItem(v,JSON.stringify(e)),console.log("Removed"),this.fetchAndInjectUserCSS(null),this.props.updateActiveTheme(null),this.props.updateColourSchemes(null,null),this.setState({installed:!1})}}installSnippet(){console.log("Installing snippet "+this.localStorageKey),localStorage.setItem(this.localStorageKey,JSON.stringify({code:this.props.item.code,title:this.props.item.title,description:this.props.item.description}));const e=h(y,[]);-1===e.indexOf(this.localStorageKey)&&(e.push(this.localStorageKey),localStorage.setItem(y,JSON.stringify(e)));var t=e.map(e=>h(e));f(t),this.setState({installed:!0})}removeSnippet(){localStorage.removeItem(this.localStorageKey);const e=h(y,[]),t=e.filter(e=>e!==this.localStorageKey);localStorage.setItem(y,JSON.stringify(t));var a=t.map(e=>h(e));f(a),this.setState({installed:!1})}async fetchAndInjectUserCSS(e){try{var t=e?await(async e=>{const t=-1<e.cssURL.indexOf("raw.githubusercontent.com")?`https://cdn.jsdelivr.net/gh/${e.user}/${e.repo}@${e.branch}/`+e.manifest.usercss:e.cssURL;var a,s=t.replace("/user.css","/assets/");console.log("Parsing CSS: ",t);let r=await fetch(t+"?time="+Date.now()).then(e=>e.text());for(const n of r.matchAll(new RegExp(`url\\(['|"](?<path>.+?)['|"]\\)`,"gm"))||[]){const l=null==(a=null==n?void 0:n.groups)?void 0:a.path;!l||l.startsWith("http")||l.startsWith("data")||(a=s+l.replace(/\.\//g,""),r=r.replace(l,a))}return r})(this.props.item.manifest):void 0;try{const a=document.querySelector("link[href='user.css']"),s=(a&&a.remove(),document.querySelector("style.marketplaceCSS.marketplaceUserCSS"));if(s&&s.remove(),t){const r=document.createElement("style");r.classList.add("marketplaceCSS"),r.classList.add("marketplaceUserCSS"),r.innerHTML=t,document.head.appendChild(r)}else{const n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href","user.css"),n.classList.add("userCSS"),document.head.appendChild(n)}}catch(e){console.warn(e)}}catch(e){console.warn(e)}}openReadme(){var e;null!=(e=this.props.item)&&e.manifest&&null!=(e=null==(e=this.props.item)?void 0:e.manifest)&&e.readme?Spicetify.Platform.History.push({pathname:X+"/readme",state:{data:{title:this.props.item.title,user:this.props.item.user,repo:this.props.item.repo,branch:this.props.item.branch,readmeURL:this.props.item.readmeURL}}}):Spicetify.showNotification("No page was found")}render(){var e,t=this.isInstalled();if("Installed"===this.props.CONFIG.activeTab&&!t)return console.log("Card item not installed"),null;const a=["main-card-card","marketplace-card--"+this.props.type],s=(t&&a.push("marketplace-card--installed"),[]);return"snippet"!==this.props.type&&this.props.visual.stars&&s.push("★ "+this.state.stars),A.default.createElement("div",{className:a.join(" "),onClick:()=>this.openReadme()},A.default.createElement("div",{className:"main-card-draggable",draggable:"true"},A.default.createElement("div",{className:"main-card-imageContainer"},A.default.createElement("div",{className:"main-cardImage-imageWrapper"},A.default.createElement("div",null,A.default.createElement("img",{alt:"","aria-hidden":"false",draggable:"false",loading:"lazy",src:this.props.item.imageURL,className:"main-image-image main-cardImage-image",onError:e=>{e.target.setAttribute("src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII"),e.target.closest(".main-cardImage-imageWrapper").classList.add("main-cardImage-imageWrapper--error")}})))),A.default.createElement("div",{className:"main-card-cardMetadata"},A.default.createElement("a",{draggable:"false",title:"snippet"===this.props.type?this.props.item.title:null==(e=this.props.item.manifest)?void 0:e.name,className:"main-cardHeader-link",dir:"auto",href:`https://github.com/${this.props.item.user}/`+this.props.item.repo,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation()},A.default.createElement("div",{className:"main-cardHeader-text main-type-balladBold"},this.props.item.title)),A.default.createElement("div",{className:"main-cardSubHeader-root main-type-mestoBold marketplace-cardSubHeader"},this.props.item.authors&&A.default.createElement(Ee,{authors:this.props.item.authors}),A.default.createElement("span",null,s.join(" ‒ "))),A.default.createElement("p",{className:"marketplace-card-desc"},"snippet"===this.props.type?this.props.item.description:null==(e=this.props.item.manifest)?void 0:e.description),this.tags.length?A.default.createElement("div",{className:"marketplace-card__bottom-meta main-type-mestoBold"},A.default.createElement(ke,{tags:this.tags,showTags:this.props.CONFIG.visual.tags})):null,t&&A.default.createElement("div",{className:"marketplace-card__bottom-meta main-type-mestoBold"},"✓ Installed"),A.default.createElement("div",{className:"main-card-PlayButtonContainer"},A.default.createElement("button",{className:"main-playButton-PlayButton main-playButton-primary","aria-label":t?Spicetify.Locale.get("remove"):Spicetify.Locale.get("save"),style:{"--size":"40px",cursor:"pointer"},onClick:e=>{e.stopPropagation(),this.buttonClicked()}},t?A.default.createElement(ye,null):A.default.createElement(be,null))))))}},we=class extends m.default.Component{constructor(e){super(e),this.endOfList=!1,this.lastScroll=0,this.requestQueue=[],this.requestPage=0,this.cardList=[],Object.assign(this,e),this.triggerRefresh=e.triggerRefresh.bind(this),this.sortConfig={by:h(Q,"top")},this.state={cards:[],tabs:e.CONFIG.tabs,rest:!0,endOfList:!1,schemes:e.CONFIG.theme.schemes,activeScheme:e.CONFIG.theme.activeScheme,activeThemeKey:e.CONFIG.theme.activeThemeKey}}getInstalledTheme(){var e=localStorage.getItem(S);if(!e)return null;e=localStorage.getItem(e);return e?JSON.parse(e):null}newRequest(e){this.cardList=[];var t=[];this.requestQueue.unshift(t),this.loadAmount(t,e)}appendCard(e,t){e=m.default.createElement(Ce,{item:e,key:this.props.CONFIG.activeTab+":"+e.title,CONFIG:this.CONFIG,visual:this.props.CONFIG.visual,type:t,activeThemeKey:this.state.activeThemeKey,updateColourSchemes:this.updateColourSchemes.bind(this),updateActiveTheme:this.setActiveTheme.bind(this)});this.cardList.push(e),this.setState({cards:this.cardList})}updateSort(e){e&&(this.sortConfig.by=e,localStorage.setItem(Q,e)),this.requestPage=0,this.cardList=[],this.setState({cards:[],rest:!1,endOfList:!1}),this.endOfList=!1,this.newRequest(E)}updateTabs(){this.setState({tabs:[...this.props.CONFIG.tabs]})}updatePostsVisual(){this.cardList=this.cardList.map(e=>m.default.createElement(Ce,d(p({},e.props),{CONFIG:this.CONFIG}))),this.setState({cards:[...this.cardList]})}switchTo(e){this.CONFIG.activeTab=e,localStorage.setItem(z,e),this.cardList=[],this.requestPage=0,this.setState({cards:[],rest:!1,endOfList:!1}),this.endOfList=!1,this.newRequest(E)}async loadPage(t){if("Extensions"===this.CONFIG.activeTab){var e=await async function(e=1,t=[]){let a=`https://api.github.com/search/repositories?q=${encodeURIComponent("topic:spicetify-extensions")}&per_page=100`;e&&(a+="&page="+e);const s=await fetch(a).then(e=>e.json()).catch(()=>[]);return s.items||Spicetify.showNotification("Too Many Requests, Cool Down."),d(p({},s),{page_count:s.items.length,items:s.items.filter(e=>!t.includes(e.html_url))})}(this.requestPage,this.BLACKLIST);for(const n of e.items){const l=await async function(t,s,r,n=!1){try{let e;var a=t.match(new RegExp("https:\\/\\/api\\.github\\.com\\/repos\\/(?<user>.+)\\/(?<repo>.+)\\/contents"));if(!a||!a.groups)return null;const{user:l,repo:i}=a.groups;return e=await ae(l,i,s),(e=Array.isArray(e)?e:[e]).reduce((e,t)=>{var a=t.branch||s,a={manifest:t,title:t.name,subtitle:t.description,authors:W(t.authors,l),user:l,repo:i,branch:a,imageURL:t.preview&&t.preview.startsWith("http")?t.preview:`https://raw.githubusercontent.com/${l}/${i}/${a}/`+t.preview,extensionURL:t.main.startsWith("http")?t.main:`https://raw.githubusercontent.com/${l}/${i}/${a}/`+t.main,readmeURL:t.readme&&t.readme.startsWith("http")?t.readme:`https://raw.githubusercontent.com/${l}/${i}/${a}/`+t.readme,stars:r,tags:t.tags};return t&&t.name&&t.description&&t.main&&(n&&localStorage.getItem(`marketplace:installed:${l}/${i}/`+t.main)||e.push(a)),e},[])}catch(e){return null}}(n.contents_url,n.default_branch,n.stargazers_count,this.CONFIG.visual.hideInstalled);if(1<this.requestQueue.length&&t!==this.requestQueue[0])return-1;l&&l.length&&l.forEach(e=>this.appendCard(e,"extension"))}var a=-1<this.requestPage&&this.requestPage?this.requestPage:1,s=E*(a-1)+e.page_count,r=e.total_count-s;if(console.log(`Parsed ${s}/${e.total_count} extensions`),0<r)return a+1;console.log("No more extension results")}else if("Installed"===this.CONFIG.activeTab){const i={theme:h(v,[]),extension:h(g,[]),snippet:h(y,[])};for(const o in i)i[o].length&&i[o].forEach(async e=>{e=h(e);if(1<this.requestQueue.length&&t!==this.requestQueue[0])return-1;this.appendCard(e,o)})}else if("Themes"==this.CONFIG.activeTab){s=await async function(e=1,t=[]){let a=`https://api.github.com/search/repositories?q=${encodeURIComponent("topic:spicetify-themes")}&per_page=100`;e&&(a+="&page="+e);const s=await fetch(a).then(e=>e.json()).catch(()=>[]);return s.items||Spicetify.showNotification("Too Many Requests, Cool Down."),d(p({},s),{page_count:s.items.length,items:s.items.filter(e=>!t.includes(e.html_url))})}(this.requestPage,this.BLACKLIST);for(const c of s.items){const u=await async function(t,s,r){try{let e;var a=t.match(new RegExp("https:\\/\\/api\\.github\\.com\\/repos\\/(?<user>.+)\\/(?<repo>.+)\\/contents"));if(!a||!a.groups)return null;const{user:n,repo:l}=a.groups;return e=await ae(n,l,s),(e=Array.isArray(e)?e:[e]).reduce((e,t)=>{var a=t.branch||s,a={manifest:t,title:t.name,subtitle:t.description,authors:W(t.authors,n),user:n,repo:l,branch:a,imageURL:t.preview&&t.preview.startsWith("http")?t.preview:`https://raw.githubusercontent.com/${n}/${l}/${a}/`+t.preview,readmeURL:t.readme&&t.readme.startsWith("http")?t.readme:`https://raw.githubusercontent.com/${n}/${l}/${a}/`+t.readme,stars:r,tags:t.tags,cssURL:t.usercss.startsWith("http")?t.usercss:`https://raw.githubusercontent.com/${n}/${l}/${a}/`+t.usercss,schemesURL:t.schemes?t.schemes.startsWith("http")?t.schemes:`https://raw.githubusercontent.com/${n}/${l}/${a}/`+t.schemes:null,include:t.include};return t&&t.name&&t.usercss&&t.description&&e.push(a),e},[])}catch(e){return null}}(c.contents_url,c.default_branch,c.stargazers_count);if(1<this.requestQueue.length&&t!==this.requestQueue[0])return-1;u&&u.length&&u.forEach(e=>this.appendCard(e,"theme"))}e=-1<this.requestPage&&this.requestPage?this.requestPage:1,r=E*(e-1)+s.page_count,a=s.total_count-r;if(console.log(`Parsed ${r}/${s.total_count} themes`),0<a)return e+1;console.log("No more theme results")}else if("Snippets"==this.CONFIG.activeTab){const m=await fetch("https://raw.githubusercontent.com/spicetify/spicetify-marketplace/main/snippets.json").then(e=>e.json()).catch(()=>{});if(1<this.requestQueue.length&&t!==this.requestQueue[0])return-1;m&&m.length&&m.forEach(e=>this.appendCard(e,"snippet"))}return this.setState({rest:!0,endOfList:!0}),this.endOfList=!0,0}async loadAmount(t,e=E){for(this.setState({rest:!1}),e+=this.cardList.length,this.requestPage=await this.loadPage(t);this.requestPage&&-1!==this.requestPage&&this.cardList.length<e&&!this.state.endOfList;)this.requestPage=await this.loadPage(t);-1===this.requestPage?this.requestQueue=this.requestQueue.filter(e=>e!==t):(this.requestQueue.shift(),this.setState({rest:!0}))}loadMore(){this.state.rest&&!this.endOfList&&this.loadAmount(this.requestQueue[0],E)}updateColourSchemes(e,t){console.log("updateColourSchemes",e,t),this.CONFIG.theme.schemes=e,this.CONFIG.theme.activeScheme=t,e&&e[t]?V(this.CONFIG.theme.schemes[t]):V(null);var a=h(S);const s=h(a);s.activeScheme=t,console.log(s),console.log(JSON.stringify(s)),localStorage.setItem(a,JSON.stringify(s)),this.setState({schemes:e,activeScheme:t})}async componentDidMount(){this.gridUpdateTabs=this.updateTabs.bind(this),this.gridUpdatePostsVisual=this.updatePostsVisual.bind(this);const e=document.querySelector(".os-viewport");this.checkScroll=this.isScrolledBottom.bind(this),e&&(e.addEventListener("scroll",this.checkScroll),this.cardList.length)?0<this.lastScroll&&e.scrollTo(0,this.lastScroll):(this.BLACKLIST=await(await fetch("https://raw.githubusercontent.com/spicetify/spicetify-marketplace/main/blacklist.json").then(e=>e.json()).catch(()=>{})).repos,this.newRequest(E))}componentWillUnmount(){this.gridUpdateTabs=this.gridUpdatePostsVisual=null;const e=document.querySelector(".os-viewport");e&&(this.lastScroll=e.scrollTop,e.removeEventListener("scroll",this.checkScroll))}isScrolledBottom(e){e=e.target;e.scrollTop+e.clientHeight>=e.scrollHeight&&this.loadMore()}setActiveTheme(e){this.CONFIG.theme.activeThemeKey=e,this.setState({activeThemeKey:e})}getActiveScheme(){return this.state.activeScheme}render(){return console.log("SPRC Version!"),m.default.createElement("section",{className:"contentSpacing"},m.default.createElement("div",{className:"marketplace-header"},m.default.createElement("h1",null,this.props.title),m.default.createElement("div",{className:"marketplace-header__right"},this.state.activeScheme?m.default.createElement(oe,{onChange:e=>this.updateColourSchemes(this.state.schemes,e),sortBoxOptions:(e=this.state.schemes)?Object.keys(e).map(e=>({key:e,value:e})):[],sortBySelectedFn:e=>e.key===this.getActiveScheme()}):null,m.default.createElement("button",{type:"button",title:"Settings",className:"marketplace-settings-button",id:"marketplace-settings-button",onClick:()=>x("SETTINGS",this.CONFIG,this.triggerRefresh)},m.default.createElement(le,null)))),[{handle:"extension",name:"Extensions"},{handle:"theme",name:"Themes"},{handle:"snippet",name:"Snippets"}].map(t=>{var e=this.cardList.filter(e=>e.props.type===t.handle).map(e=>{return m.default.cloneElement(e,{activeThemeKey:this.state.activeThemeKey})});return e.length?m.default.createElement(m.default.Fragment,null,m.default.createElement("h2",{className:"marketplace-card-type-heading"},t.name),m.default.createElement("div",{className:"marketplace-grid main-gridContainer-gridContainer main-gridContainer-fixedWidth","data-tab":this.CONFIG.activeTab,style:{"--minimumColumnWidth":"180px","--column-width":"minmax(var(--minimumColumnWidth),1fr)","--column-count":"auto-fill","--grid-gap":"24px"}},e)):null}),m.default.createElement("footer",{style:{margin:"auto",textAlign:"center"}},!this.state.endOfList&&(this.state.rest?m.default.createElement(se,{onClick:this.loadMore.bind(this)}):m.default.createElement(re,null)),"Snippets"===this.CONFIG.activeTab?m.default.createElement("button",{className:"marketplace-add-snippet-btn main-buttons-button main-button-secondary",onClick:()=>x("ADD_SNIPPET")},"+Add CSS"):null),m.default.createElement(he,{switchCallback:this.switchTo.bind(this),links:this.CONFIG.tabs,activeLink:this.CONFIG.activeTab}));var e}},_=c(a("react")),Ne=class extends _.default.Component{constructor(){super(...arguments),this.state={html:"<p>Loading...</p>"}}async getReadmeHTML(){try{const a=await fetch(this.props.data.readmeURL);if(!a.ok)throw Spicetify.showNotification(`Error loading README (HTTP ${a.status})`);var e={text:await a.text(),context:this.props.data.user+"/"+this.props.data.repo,mode:"gfm"};const s=await fetch("https://api.github.com/markdown",{method:"POST",body:JSON.stringify(e)});if(!s.ok)throw Spicetify.showNotification(`Error parsing README (HTTP ${s.status})`);var t=await s.text();return null==t&&Spicetify.Platform.History.goBack(),t}catch(e){return Spicetify.Platform.History.goBack(),null}}componentDidMount(){this.getReadmeHTML().then(e=>{null!=e&&this.setState({html:e})})}componentDidUpdate(){document.querySelectorAll("#marketplace-readme img").forEach(e=>{e.addEventListener("error",e=>{var t=e.target.getAttribute("src"),t=`https://raw.githubusercontent.com/${this.props.data.user}/${this.props.data.repo}/${this.props.data.branch}/`+t;e.target.setAttribute("src",t)},{once:!0})})}render(){return _.default.createElement("section",{className:"contentSpacing"},_.default.createElement("div",{className:"marketplace-header"},_.default.createElement("h1",null,this.props.title)),_.default.createElement("div",{id:"marketplace-readme",className:"marketplace-readme__container",dangerouslySetInnerHTML:{__html:this.state.html}}))}},Oe=class extends u.default.Component{constructor(e){super(e),this.state={count:0,CONFIG:{}},this.updateConfig=e=>{this.CONFIG=p({},e),console.log("updated config",this.CONFIG),this.setState({CONFIG:p({},e)})};e=h(b,null);let t=[];try{if(t=JSON.parse(e),!Array.isArray(t))throw new Error("Could not parse marketplace tabs key");if(0===t.length)throw new Error("Empty marketplace tabs key");if(0<t.filter(e=>!e).length)throw new Error("Falsey marketplace tabs key")}catch(e){t=Y,localStorage.setItem(b,JSON.stringify(t))}let a=[],s=null;try{var r=h(S,null);if(r){var n=h(r,null);if(!n)throw new Error("No installed theme data");a=n.schemes,s=n.activeScheme}else console.log("No theme set as installed")}catch(e){console.error(e)}this.CONFIG={visual:{stars:JSON.parse(h("marketplace:stars",!0)),tags:JSON.parse(h("marketplace:tags",!0)),hideInstalled:JSON.parse(h("marketplace:hideInstalled",!1)),colorShift:JSON.parse(h("marketplace:colorShift",!1)),type:JSON.parse(h("marketplace:type",!1)),followers:JSON.parse(h("marketplace:followers",!1))},tabs:t,activeTab:h(z,t[0]),theme:{activeThemeKey:h(S,null),schemes:a,activeScheme:s}},this.CONFIG.activeTab&&this.CONFIG.tabs.filter(e=>e.name===this.CONFIG.activeTab).length||(this.CONFIG.activeTab=this.CONFIG.tabs[0].name)}render(){var e=Spicetify.Platform.History["location"];return e.pathname===X+"/readme"?u.default.createElement(Ne,{title:"Spicetify Marketplace - Readme",data:e.state.data}):u.default.createElement(we,{title:"Spicetify Marketplace",CONFIG:this.CONFIG,triggerRefresh:this.updateConfig})}},Ie=c(a("react"));return t=D,o(n({},"__esModule",{value:!0}),t)})();const render=()=>marketplace.default();